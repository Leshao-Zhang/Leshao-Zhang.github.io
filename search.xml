<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Arduino BLINK LED</title>
    <url>/2020/06/15/Arduino_Reflection/</url>
    <content><![CDATA[<h2 id="BLINK"><a href="#BLINK" class="headerlink" title="BLINK"></a>BLINK</h2><p>在做过Arduino第一个实验BLINK之后看这篇笔记，可以加深对Arduino的理解。这篇文章不会讲代码怎么写，仅对电路实验的基本原理说明。</p>
<p>在学习Arduino时第一个电路实验大多为BLINK连接LED实验。</p>
<img data-src="/2020/06/15/Arduino_Reflection/Arduino_Reflection.png">

<p><em>图 1 LED 连接方法</em></p>
<a id="more"></a>

<p>将电路按图1连好，并把example里basic中的blink代码上传到Arduino之后，就可以看到LED灯一闪一闪了。</p>
<p>这个实验非常严简单，基本不会有太多惊讶与疑问。但如果仔细思考，还是会发现许多问题的。比如在这个实验中，我们知道给LED加上560欧的电阻是为了限流，但为什么要用560欧的电阻而不用1K欧，10K欧呢？</p>
<p>网上的资料显示，LED的工作电压一般为1.5-2V，工作电流一般为10-20ma，反向击穿电压为5V。而Arduino的pin口提供5V的电压，需要的电阻为150欧到350欧。根据欧姆定律，计算公式为：</p>
<img data-src="/2020/06/15/Arduino_Reflection/equation ohm.png">

<p>其中r为要求的电阻；Up 为pin口电压，此处为5V；UL 为LED的工作电压；I为LED的工作电流。</p>
<p><a href="http://www.21ic.com/calculator/LEDfaguang.htm" target="_blank" rel="noopener">http://www.21ic.com/calculator/LEDfaguang.htm</a> 提供了LED电路电阻计算器（图2）。</p>
<img data-src="/2020/06/15/Arduino_Reflection/Arduino_Reflection2.png">

<p><em>图 2 LED电路电阻计算器</em></p>
<p>经过计算，我们用的560欧的电阻比正常的LED电路需要的电阻大了一些。</p>
<p>这是因为我们的实验配发的Arduino套件中仅配发了560欧，2.2K欧与10K欧三种电阻。那么能用的就只有560欧这个最小的电阻了。</p>
<p>用过大电阻并非没有好处，这样做可以尽量保护电路不会过载，代价仅是LED稍微不那么亮了。当然需要注意的是在某些要求特定电压的电路中是不可以将就用电阻的。</p>
<p>这就是第一个Arduino实验中隐藏的小问题了。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>在连接每一个电路的时候，一定要查清楚每个元器件的参数，其工作电压，工作电流等。通过合适的搭配电路元器件避免烧毁Arduino控制板和元器件。</p>
]]></content>
      <categories>
        <category>Arduino</category>
      </categories>
      <tags>
        <tag>Arduino</tag>
        <tag>欧姆定律</tag>
        <tag>电路</tag>
        <tag>LED</tag>
      </tags>
  </entry>
  <entry>
    <title>Arduino 深入理解按钮</title>
    <url>/2020/06/16/Arduino_Reflection_2/</url>
    <content><![CDATA[<h2 id="按钮"><a href="#按钮" class="headerlink" title="按钮"></a>按钮</h2><p>按钮是我们常用的硬件交互部件，也是我们学习Arduino一开始就接触到的部件。深入了解按钮的特性能够让我们搭建硬件原型的时候避免一些奇怪的BUG。</p>
<img data-src="/2020/06/16/Arduino_Reflection_2/figure 1.png">

<p><em>图1 按钮电路</em></p>
<a id="more"></a>

<h2 id="电路连接方法"><a href="#电路连接方法" class="headerlink" title="电路连接方法"></a>电路连接方法</h2><p>一个包含按钮的最简单的Arduino控制电路由一个按钮，一个电阻，三根电线和Arduino控制板组合而成。配的电阻一般较大，比如此处配10K欧，这个电阻十分重要，没有这个电阻，电路会有短路烧坏Arduino板的危险。</p>
<p><strong>Arduino Pin 口最大电流不得超过 40mA, 总电流不得超过200mA。</strong></p>
<p>按图1电路连好后上传EXAMPLE-&gt;DIGIT-&gt;BUTTON的代码就可以使用按钮控制Arduino板上的LED的明灭了。此时，按下按钮，LED亮；松开按钮LED灭。</p>
<p>还有一种连接方法是将上述电路中的5V与GND连线互换。这样，当按钮按下时LED灭，松开时LED亮。</p>
<p>我们称呼前一种电路为<strong>下拉电阻</strong>电路，后一种为<strong>上拉电阻</strong>电路。这一个电阻在两个电路中分别作为下拉电阻和上拉电阻。上拉电路和下拉电路有不同的应用方式。如要保持电路中存在电流，就要选用上拉电路，比如防盗电路。</p>
<h2 id="按钮消抖"><a href="#按钮消抖" class="headerlink" title="按钮消抖"></a>按钮消抖</h2><p>有时，我们做了一个按键计数器，就像这样：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> buttonPin 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> buttonPressed = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">boolean</span> buttonDown = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span>&#123;</span><br><span class="line">  buttonDown = <span class="built_in">digitalRead</span>(buttonPin);</span><br><span class="line">  <span class="keyword">if</span>(buttonDown &amp;&amp; !buttonPressed)&#123;<span class="comment">//按下</span></span><br><span class="line">    buttonPressed = <span class="literal">true</span>;</span><br><span class="line">    count++;</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">println</span>(count);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!buttonDown)&#123;<span class="comment">//释放		</span></span><br><span class="line">      buttonPressed = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在我们的想象中，当我们每次按一下按钮，计数器就会加1。但是实际上当我们按下按钮时，计数器却一次增加了很多。代码好像又没写错，那到底是哪里出现了问题呢？</p>
<p>原来普通的弹簧按钮在按下去的时候会产生抖动，在5-10ms中，这个抖动的按钮可能已经开关电路好几次了，而计数器就计了好几次（如图2）。这就是这个BUG的罪魁祸首。</p>
<img data-src="/2020/06/16/Arduino_Reflection_2/figure 2.jpg">

<p><strong>图2 按键抖动</strong></p>
<p>可以用硬件或软件的方法消除这个抖动。</p>
<p>硬件的方法有RS触发器消抖(有兴趣自己去了解)和并联电容法（如图3）。</p>
<img data-src="/2020/06/16/Arduino_Reflection_2/figure 3.jpg">

<p><strong>图3 并联电容消抖</strong></p>
<p>使用硬件消抖会产生额外的硬件成本。而我们还有软件消抖法，即按下按键后10~20ms后再判断按键是否为抖动。以下为实现方法：</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> buttonPin 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> buttonPressed = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">boolean</span> buttonDown = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">boolean</span> counted = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> timer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  buttonDown = <span class="built_in">digitalRead</span>(buttonPin);</span><br><span class="line">  <span class="keyword">if</span> (buttonDown &amp;&amp; !buttonPressed) &#123;<span class="comment">//按下</span></span><br><span class="line">    buttonPressed = <span class="literal">true</span>;</span><br><span class="line">    counted = <span class="literal">false</span>;</span><br><span class="line">    timer = <span class="built_in">millis</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (buttonDown &amp;&amp; <span class="built_in">millis</span>() - timer &gt; <span class="number">20</span> &amp;&amp; !counted) &#123;<span class="comment">//延迟20ms忽略抖动</span></span><br><span class="line">    count++;</span><br><span class="line">    counted = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">println</span>(count);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!buttonDown &amp;&amp; buttonPressed)<span class="comment">//释放</span></span><br><span class="line">    buttonPressed = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>按钮是最常用的电路元件之一，而要用好按钮，掌握上拉电阻电路、下拉电阻电路和按钮消抖是十分必要的。在设计搭建电路的同时，必须先考虑好电路要实现的功能，和可能会出现的问题，从而避免花费时间寻找BUG。</p>
]]></content>
      <categories>
        <category>Arduino</category>
      </categories>
      <tags>
        <tag>Arduino</tag>
        <tag>按钮</tag>
        <tag>上拉电阻</tag>
        <tag>下拉电阻</tag>
        <tag>按键消抖</tag>
      </tags>
  </entry>
</search>
