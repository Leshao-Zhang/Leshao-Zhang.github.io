{"title":"Arduino 深入理解按钮","slug":"Arduino_Reflection_2","date":"2020-06-16T08:02:15.000Z","updated":"2020-06-16T10:53:59.879Z","comments":true,"path":"api/articles/Arduino_Reflection_2.json","excerpt":"按钮按钮是我们常用的硬件交互部件，也是我们学习Arduino一开始就接触到的部件。深入了解按钮的特性能够让我们搭建硬件原型的时候避免一些奇怪的BUG。 [Figure] 图1 按钮电路","covers":null,"content":"<h2 id=\"按钮\"><a href=\"#按钮\" class=\"headerlink\" title=\"按钮\"></a>按钮</h2><p>按钮是我们常用的硬件交互部件，也是我们学习Arduino一开始就接触到的部件。深入了解按钮的特性能够让我们搭建硬件原型的时候避免一些奇怪的BUG。</p>\n<img data-src=\"/2020/06/16/Arduino_Reflection_2/figure 1.png\">\n\n<p><em>图1 按钮电路</em></p>\n<a id=\"more\"></a>\n\n<h2 id=\"电路连接方法\"><a href=\"#电路连接方法\" class=\"headerlink\" title=\"电路连接方法\"></a>电路连接方法</h2><p>一个包含按钮的最简单的Arduino控制电路由一个按钮，一个电阻，三根电线和Arduino控制板组合而成。配的电阻一般较大，比如此处配10K欧，这个电阻十分重要，没有这个电阻，电路会有短路烧坏Arduino板的危险。</p>\n<p><strong>Arduino Pin 口最大电流不得超过 40mA, 总电流不得超过200mA。</strong></p>\n<p>按图1电路连好后上传EXAMPLE-&gt;DIGIT-&gt;BUTTON的代码就可以使用按钮控制Arduino板上的LED的明灭了。此时，按下按钮，LED亮；松开按钮LED灭。</p>\n<p>还有一种连接方法是将上述电路中的5V与GND连线互换。这样，当按钮按下时LED灭，松开时LED亮。</p>\n<p>我们称呼前一种电路为<strong>下拉电阻</strong>电路，后一种为<strong>上拉电阻</strong>电路。这一个电阻在两个电路中分别作为下拉电阻和上拉电阻。上拉电路和下拉电路有不同的应用方式。如要保持电路中存在电流，就要选用上拉电路，比如防盗电路。</p>\n<h2 id=\"按钮消抖\"><a href=\"#按钮消抖\" class=\"headerlink\" title=\"按钮消抖\"></a>按钮消抖</h2><p>有时，我们做了一个按键计数器，就像这样：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> buttonPin 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonDown = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  buttonDown = <span class=\"built_in\">digitalRead</span>(buttonPin);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(buttonDown &amp;&amp; !buttonPressed)&#123;<span class=\"comment\">//按下</span></span><br><span class=\"line\">    buttonPressed = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(count);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!buttonDown)&#123;<span class=\"comment\">//释放\t\t</span></span><br><span class=\"line\">      buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在我们的想象中，当我们每次按一下按钮，计数器就会加1。但是实际上当我们按下按钮时，计数器却一次增加了很多。代码好像又没写错，那到底是哪里出现了问题呢？</p>\n<p>原来普通的弹簧按钮在按下去的时候会产生抖动，在5-10ms中，这个抖动的按钮可能已经开关电路好几次了，而计数器就计了好几次（如图2）。这就是这个BUG的罪魁祸首。</p>\n<img data-src=\"/2020/06/16/Arduino_Reflection_2/figure 2.jpg\">\n\n<p><strong>图2 按键抖动</strong></p>\n<p>可以用硬件或软件的方法消除这个抖动。</p>\n<p>硬件的方法有RS触发器消抖(有兴趣自己去了解)和并联电容法（如图3）。</p>\n<img data-src=\"/2020/06/16/Arduino_Reflection_2/figure 3.jpg\">\n\n<p><strong>图3 并联电容消抖</strong></p>\n<p>使用硬件消抖会产生额外的硬件成本。而我们还有软件消抖法，即按下按键后10~20ms后再判断按键是否为抖动。以下为实现方法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> buttonPin 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonDown = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">boolean</span> counted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  buttonDown = <span class=\"built_in\">digitalRead</span>(buttonPin);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (buttonDown &amp;&amp; !buttonPressed) &#123;<span class=\"comment\">//按下</span></span><br><span class=\"line\">    buttonPressed = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    counted = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    timer = <span class=\"built_in\">millis</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (buttonDown &amp;&amp; <span class=\"built_in\">millis</span>() - timer &gt; <span class=\"number\">20</span> &amp;&amp; !counted) &#123;<span class=\"comment\">//延迟20ms忽略抖动</span></span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    counted = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(count);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!buttonDown &amp;&amp; buttonPressed)<span class=\"comment\">//释放</span></span><br><span class=\"line\">    buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><p>按钮是最常用的电路元件之一，而要用好按钮，掌握上拉电阻电路、下拉电阻电路和按钮消抖是十分必要的。在设计搭建电路的同时，必须先考虑好电路要实现的功能，和可能会出现的问题，从而避免花费时间寻找BUG。</p>\n","more":"<h2 id=\"电路连接方法\"><a href=\"#电路连接方法\" class=\"headerlink\" title=\"电路连接方法\"></a>电路连接方法</h2><p>一个包含按钮的最简单的Arduino控制电路由一个按钮，一个电阻，三根电线和Arduino控制板组合而成。配的电阻一般较大，比如此处配10K欧，这个电阻十分重要，没有这个电阻，电路会有短路烧坏Arduino板的危险。</p>\n<p><strong>Arduino Pin 口最大电流不得超过 40mA, 总电流不得超过200mA。</strong></p>\n<p>按图1电路连好后上传EXAMPLE-&gt;DIGIT-&gt;BUTTON的代码就可以使用按钮控制Arduino板上的LED的明灭了。此时，按下按钮，LED亮；松开按钮LED灭。</p>\n<p>还有一种连接方法是将上述电路中的5V与GND连线互换。这样，当按钮按下时LED灭，松开时LED亮。</p>\n<p>我们称呼前一种电路为<strong>下拉电阻</strong>电路，后一种为<strong>上拉电阻</strong>电路。这一个电阻在两个电路中分别作为下拉电阻和上拉电阻。上拉电路和下拉电路有不同的应用方式。如要保持电路中存在电流，就要选用上拉电路，比如防盗电路。</p>\n<h2 id=\"按钮消抖\"><a href=\"#按钮消抖\" class=\"headerlink\" title=\"按钮消抖\"></a>按钮消抖</h2><p>有时，我们做了一个按键计数器，就像这样：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> buttonPin 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonDown = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">  buttonDown = <span class=\"built_in\">digitalRead</span>(buttonPin);</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(buttonDown &amp;&amp; !buttonPressed)&#123;<span class=\"comment\">//按下</span></span><br><span class=\"line\">    buttonPressed = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(count);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!buttonDown)&#123;<span class=\"comment\">//释放\t\t</span></span><br><span class=\"line\">      buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在我们的想象中，当我们每次按一下按钮，计数器就会加1。但是实际上当我们按下按钮时，计数器却一次增加了很多。代码好像又没写错，那到底是哪里出现了问题呢？</p>\n<p>原来普通的弹簧按钮在按下去的时候会产生抖动，在5-10ms中，这个抖动的按钮可能已经开关电路好几次了，而计数器就计了好几次（如图2）。这就是这个BUG的罪魁祸首。</p>\n<img src=\"/2020/06/16/Arduino_Reflection_2/figure 2.jpg\">\n\n<p><strong>图2 按键抖动</strong></p>\n<p>可以用硬件或软件的方法消除这个抖动。</p>\n<p>硬件的方法有RS触发器消抖(有兴趣自己去了解)和并联电容法（如图3）。</p>\n<img src=\"/2020/06/16/Arduino_Reflection_2/figure 3.jpg\">\n\n<p><strong>图3 并联电容消抖</strong></p>\n<p>使用硬件消抖会产生额外的硬件成本。而我们还有软件消抖法，即按下按键后10~20ms后再判断按键是否为抖动。以下为实现方法：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> buttonPin 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">boolean</span> buttonDown = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">boolean</span> counted = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> timer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">Serial</span>.<span class=\"built_in\">begin</span>(<span class=\"number\">9600</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">loop</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  buttonDown = <span class=\"built_in\">digitalRead</span>(buttonPin);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (buttonDown &amp;&amp; !buttonPressed) &#123;<span class=\"comment\">//按下</span></span><br><span class=\"line\">    buttonPressed = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    counted = <span class=\"literal\">false</span>;</span><br><span class=\"line\">    timer = <span class=\"built_in\">millis</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (buttonDown &amp;&amp; <span class=\"built_in\">millis</span>() - timer &gt; <span class=\"number\">20</span> &amp;&amp; !counted) &#123;<span class=\"comment\">//延迟20ms忽略抖动</span></span><br><span class=\"line\">    count++;</span><br><span class=\"line\">    counted = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"built_in\">Serial</span>.<span class=\"built_in\">println</span>(count);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!buttonDown &amp;&amp; buttonPressed)<span class=\"comment\">//释放</span></span><br><span class=\"line\">    buttonPressed = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><p>按钮是最常用的电路元件之一，而要用好按钮，掌握上拉电阻电路、下拉电阻电路和按钮消抖是十分必要的。在设计搭建电路的同时，必须先考虑好电路要实现的功能，和可能会出现的问题，从而避免花费时间寻找BUG。</p>","categories":[{"name":"Arduino","path":"api/categories/Arduino.json"}],"tags":[{"name":"Arduino","path":"api/tags/Arduino.json"},{"name":"按钮","path":"api/tags/按钮.json"},{"name":"上拉电阻","path":"api/tags/上拉电阻.json"},{"name":"下拉电阻","path":"api/tags/下拉电阻.json"},{"name":"按键消抖","path":"api/tags/按键消抖.json"}]}